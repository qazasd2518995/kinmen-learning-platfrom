<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>實戰練習 - 金聲玉語</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="description" content="金門話綜合練習">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&family=Noto+Serif+TC:wght@500;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Dashboard 變數 */
      --header-height: 56px;
      --content-height: calc(100dvh - var(--header-height) - 8px);
      --dashboard-gap: 1rem;

      /* 動態字體 */
      --h1-size: clamp(1.5rem, 3vw, 2.5rem);
      --h2-size: clamp(1.25rem, 2.5vw, 2rem);
      --body-size: clamp(0.875rem, 1.2vw, 1rem);

      /* 原有變數 */
      --kinmen-gold: #D4A84B;
      --kinmen-gold-light: #F5E6C8;
      --kinmen-gold-dark: #8B6914;
      --kinmen-red: #C84B31;
      --kinmen-red-light: #E8B4A8;
      --kinmen-red-lighter: #FDF2F0;
      --kinmen-ocean: #5B8FA8;
      --kinmen-ocean-light: #C5DDE8;
      --kinmen-ocean-lighter: #E8F4F8;
      --kinmen-green: #7D9D6D;
      --kinmen-green-light: #D4E5CC;
      --kinmen-green-lighter: #EDF5E8;
      --bg-primary: #FDF6F0;
      --bg-secondary: #F5E8E0;
      --bg-card: #FFFFFF;
      --text-primary: #3D3229;
      --text-secondary: #6B5D52;
      --text-accent: #8B6914;
      --deco-brick: #B85A4A;
      --shadow-sm: 0 2px 8px rgba(61, 50, 41, 0.08);
      --shadow-md: 0 4px 16px rgba(61, 50, 41, 0.12);
      --shadow-lg: 0 8px 32px rgba(61, 50, 41, 0.16);
      --shadow-xl: 0 16px 48px rgba(61, 50, 41, 0.2);
      --shadow-lift-sm: 0 4px 12px rgba(61, 50, 41, 0.15);
      --shadow-lift-md: 0 8px 24px rgba(61, 50, 41, 0.18);
      --glow-gold: 0 0 20px rgba(212, 168, 75, 0.3);
      --glow-ocean: 0 0 20px rgba(91, 143, 168, 0.3);
      --glow-green: 0 0 20px rgba(125, 157, 109, 0.3);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-xl: 32px;
      --font-display: 'Noto Serif TC', serif;
      --font-body: 'Noto Sans TC', sans-serif;
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
      --duration-fast: 150ms;
      --duration-normal: 250ms;
      --duration-slow: 400ms;
      --duration-slower: 600ms;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; }
    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }
    button { font-family: inherit; border: none; background: none; cursor: pointer; }
    a { text-decoration: none; color: inherit; }

    /* 全域觸控優化 */
    button, [role="button"], .interactive, a, .practice-mode-card, .vocab-btn {
      touch-action: manipulation;
    }

    /* 輸入框防 iOS 縮放 */
    input, textarea, select {
      font-size: max(16px, 1rem);
    }

    /* 觸控目標標準 */
    :root {
      --touch-target-min: 44px;
      --touch-target-comfortable: 48px;
      --touch-spacing-min: 8px;
    }

    /* 背景 */
    .bg-pattern {
      position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0.08;
      background-image:
        repeating-linear-gradient(45deg, var(--deco-brick) 0, var(--deco-brick) 2px, transparent 2px, transparent 20px),
        repeating-linear-gradient(-45deg, var(--deco-brick) 0, var(--deco-brick) 2px, transparent 2px, transparent 20px);
    }
    .bg-gradient {
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
      background:
        radial-gradient(ellipse 80% 50% at 20% 0%, rgba(212, 168, 75, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(91, 143, 168, 0.1) 0%, transparent 50%);
    }
    .roof-deco {
      position: fixed; top: 0; left: 0; right: 0; height: 8px;
      background: linear-gradient(90deg, var(--kinmen-gold) 0%, var(--kinmen-red) 25%, var(--kinmen-gold) 50%, var(--kinmen-red) 75%, var(--kinmen-gold) 100%);
      z-index: 100;
    }

    /* 頂部導航 */
    .nav-header {
      position: sticky; top: 8px; z-index: 50;
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 24px;
      background: rgba(253, 246, 240, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(139, 105, 20, 0.1);
    }
    .nav-left { display: flex; align-items: center; gap: 16px; }
    .back-btn {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px; border-radius: var(--radius-md);
      color: var(--text-secondary); font-weight: 500;
      transition: all 0.25s var(--ease-out);
    }
    .back-btn:hover { background: var(--bg-secondary); color: var(--text-primary); }
    .back-btn svg { width: 20px; height: 20px; }
    .page-title {
      font-family: var(--font-display);
      font-size: 1.25rem; font-weight: 700;
      color: var(--text-accent);
    }

    /* 主內容 */
    .main-content {
      position: relative; z-index: 1;
      max-width: 800px; margin: 0 auto;
      padding: 32px 24px 80px;
    }

    /* 練習模式選擇 */
    .practice-modes {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    .practice-mode-card {
      padding: 24px;
      background: var(--bg-card);
      border: 2px solid rgba(107, 93, 82, 0.1);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      text-align: center;
      cursor: pointer;
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
      overflow: hidden;
    }
    .practice-mode-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kinmen-green), var(--kinmen-gold));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform var(--duration-normal) var(--ease-out);
    }
    .practice-mode-card:hover {
      border-color: var(--kinmen-green-light);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg), var(--glow-green);
    }
    .practice-mode-card:hover::before {
      transform: scaleX(1);
    }
    .practice-mode-card.active {
      border-color: var(--kinmen-green);
      background: linear-gradient(135deg, var(--kinmen-green-lighter) 0%, var(--bg-card) 100%);
      box-shadow: var(--shadow-md), var(--glow-green);
    }
    .practice-mode-card.active::before {
      transform: scaleX(1);
      background: var(--kinmen-green);
    }
    .mode-icon {
      width: 64px; height: 64px;
      display: flex; align-items: center; justify-content: center;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      margin: 0 auto 16px;
      transition: all var(--duration-normal) var(--ease-out);
    }
    .mode-icon svg {
      width: 32px;
      height: 32px;
      color: var(--text-secondary);
      transition: color var(--duration-normal);
    }
    .practice-mode-card:hover .mode-icon {
      transform: scale(1.1);
    }
    .practice-mode-card.active .mode-icon {
      background: linear-gradient(135deg, var(--kinmen-green) 0%, #5A8A4A 100%);
      box-shadow: var(--shadow-md);
    }
    .practice-mode-card.active .mode-icon svg {
      color: white;
    }
    .mode-title {
      font-family: var(--font-display);
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    .mode-desc {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* 練習區域 */
    .practice-area {
      display: none;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: 32px;
      box-shadow: var(--shadow-lg);
      animation: fadeIn 0.4s var(--ease-out);
      position: relative;
      overflow: hidden;
    }
    .practice-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kinmen-gold), var(--kinmen-ocean), var(--kinmen-green));
    }
    .practice-area.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* 購物清單挑戰 */
    .shopping-header {
      text-align: center;
      margin-bottom: 32px;
    }
    .shopping-title {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .shopping-title::before {
      content: '';
      display: inline-block;
      width: 28px;
      height: 28px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238B6914' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='9' cy='21' r='1'/%3E%3Ccircle cx='20' cy='21' r='1'/%3E%3Cpath d='M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6'/%3E%3C/svg%3E");
      background-size: contain;
    }
    .shopping-desc {
      color: var(--text-secondary);
    }
    .shopping-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 32px;
      padding: 24px;
      background: linear-gradient(135deg, var(--kinmen-gold-light) 0%, rgba(245, 230, 200, 0.5) 100%);
      border-radius: var(--radius-lg);
      border: 2px solid rgba(212, 168, 75, 0.2);
    }
    .shopping-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--bg-card);
      border-radius: var(--radius-md);
      font-weight: 600;
      border: 2px solid transparent;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: var(--shadow-sm);
    }
    .shopping-item.found {
      background: var(--kinmen-green-lighter);
      border-color: var(--kinmen-green);
      color: var(--kinmen-green);
      animation: itemFound 0.5s var(--spring);
    }
    .shopping-item.found span:nth-child(2) {
      text-decoration: line-through;
    }
    @keyframes itemFound {
      0% { transform: scale(1); }
      30% { transform: scale(1.15); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    .shopping-item svg {
      width: 20px;
      height: 20px;
      transition: all var(--duration-normal) var(--ease-out);
    }
    .shopping-item.found svg {
      color: var(--kinmen-green);
      animation: checkPop 0.4s var(--spring);
    }
    @keyframes checkPop {
      0% { transform: scale(0) rotate(-45deg); opacity: 0; }
      50% { transform: scale(1.3) rotate(0deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    .vocab-btn {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: var(--bg-secondary);
      border: 2px solid transparent;
      border-radius: var(--radius-md);
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
      overflow: hidden;
      min-width: 70px;
      min-height: 70px;
    }
    .vocab-btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(212, 168, 75, 0.2) 0%, transparent 70%);
      opacity: 0;
      transition: opacity var(--duration-fast);
    }
    .vocab-btn:hover:not(.found):not(.wrong) {
      border-color: var(--kinmen-gold);
      background: var(--kinmen-gold-light);
      transform: translateY(-4px);
      box-shadow: var(--shadow-md), var(--glow-gold);
    }
    .vocab-btn:hover:not(.found):not(.wrong)::after {
      opacity: 1;
    }
    .vocab-btn:active:not(.found):not(.wrong) {
      transform: scale(0.95);
      box-shadow: var(--shadow-sm);
    }
    .vocab-btn.found {
      background: var(--kinmen-green-lighter);
      border-color: var(--kinmen-green);
      pointer-events: none;
      animation: vocabFound 0.5s var(--spring);
    }
    .vocab-btn.found::before {
      content: '✓';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 22px;
      height: 22px;
      background: var(--kinmen-green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      animation: checkPop 0.4s var(--spring);
    }
    @keyframes vocabFound {
      0% { transform: scale(1); }
      30% { transform: scale(1.1); }
      60% { transform: scale(0.98); }
      100% { transform: scale(1); }
    }
    .vocab-btn.wrong {
      animation: vocabWrong 0.5s ease-out;
      background: var(--kinmen-red-lighter);
      border-color: var(--kinmen-red);
    }
    @keyframes vocabWrong {
      0%, 100% { transform: translateX(0); }
      15% { transform: translateX(-8px); }
      30% { transform: translateX(8px); }
      45% { transform: translateX(-6px); }
      60% { transform: translateX(6px); }
      75% { transform: translateX(-3px); }
      90% { transform: translateX(3px); }
    }
    .vocab-btn img {
      width: 60%;
      height: 60%;
      object-fit: contain;
      transition: transform var(--duration-normal) var(--ease-out);
    }
    .vocab-btn:hover:not(.found):not(.wrong) img {
      transform: scale(1.1);
    }
    .vocab-btn .vocab-name {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-top: 4px;
    }

    /* 進度條 */
    .shopping-progress {
      margin-top: 24px;
    }
    .progress-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }
    .progress-bar-container {
      flex: 1;
      max-width: 300px;
      height: 12px;
      background: var(--bg-secondary);
      border-radius: 100px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(61, 50, 41, 0.1);
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--kinmen-green) 0%, var(--kinmen-gold) 100%);
      border-radius: 100px;
      transition: width var(--duration-slow) var(--ease-out);
      position: relative;
    }
    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 50%;
      background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 100%);
      border-radius: 100px 100px 0 0;
    }
    .progress-text {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-accent);
      min-width: 80px;
    }

    /* 計算價格 */
    .calculation-header {
      text-align: center;
      margin-bottom: 32px;
    }
    .calculation-title {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .calculation-title::before {
      content: '';
      display: inline-block;
      width: 28px;
      height: 28px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238B6914' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='12' y1='1' x2='12' y2='23'/%3E%3Cpath d='M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6'/%3E%3C/svg%3E");
      background-size: contain;
    }
    .calculation-question {
      padding: 24px;
      background: linear-gradient(135deg, var(--kinmen-ocean-lighter) 0%, rgba(197, 221, 232, 0.5) 100%);
      border-radius: var(--radius-lg);
      margin-bottom: 24px;
      border: 2px solid rgba(91, 143, 168, 0.2);
    }
    .question-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0;
      border-bottom: 2px dashed rgba(91, 143, 168, 0.2);
      transition: all var(--duration-normal) var(--ease-out);
    }
    .question-item:last-child { border-bottom: none; }
    .question-item:hover {
      background: rgba(91, 143, 168, 0.1);
      padding-left: 12px;
      padding-right: 12px;
      margin: 0 -12px;
      border-radius: var(--radius-sm);
    }
    .item-name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1.0625rem;
    }
    .item-price {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .play-price-btn {
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, var(--kinmen-ocean) 0%, #4A7A8F 100%);
      color: white;
      border-radius: 50%;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: var(--shadow-sm);
    }
    .play-price-btn:hover {
      transform: scale(1.15);
      box-shadow: var(--shadow-md), var(--glow-ocean);
    }
    .play-price-btn:active {
      transform: scale(0.95);
    }
    .play-price-btn.playing {
      animation: pricePulse 1s ease-in-out infinite;
    }
    @keyframes pricePulse {
      0%, 100% { transform: scale(1); box-shadow: var(--shadow-sm); }
      50% { transform: scale(1.1); box-shadow: var(--shadow-md), 0 0 15px rgba(91, 143, 168, 0.4); }
    }
    .play-price-btn svg { width: 16px; height: 16px; }
    .price-text {
      font-family: var(--font-display);
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--kinmen-ocean);
      background: var(--bg-card);
      padding: 4px 12px;
      border-radius: var(--radius-sm);
    }
    .answer-section {
      text-align: center;
      padding: 24px;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
    }
    .answer-label {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      font-size: 1.125rem;
    }
    .answer-input-group {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    .answer-input {
      width: 100%;
      max-width: 140px;
      padding: 16px 20px;
      font-family: inherit;
      font-size: clamp(1.25rem, 4vw, 1.75rem);
      font-weight: 700;
      text-align: center;
      background: var(--bg-card);
      border: 3px solid var(--kinmen-ocean-light);
      border-radius: var(--radius-md);
      transition: all var(--duration-normal) var(--ease-out);
      color: var(--kinmen-ocean);
    }
    .answer-input:focus {
      outline: none;
      border-color: var(--kinmen-gold);
      box-shadow: var(--glow-gold), var(--shadow-md);
    }
    .answer-input::placeholder {
      color: var(--bg-secondary);
    }
    .answer-unit {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--kinmen-gold);
    }
    .check-answer-btn {
      display: block;
      width: 100%;
      max-width: 200px;
      margin: 24px auto 0;
      padding: 14px 24px;
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 1rem;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    .check-answer-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
      opacity: 0;
      transition: opacity var(--duration-fast);
    }
    .check-answer-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .check-answer-btn:hover::before {
      opacity: 1;
    }
    .check-answer-btn:active {
      transform: scale(0.98);
    }
    .calc-feedback {
      display: none;
      margin-top: 24px;
      padding: 16px 24px;
      border-radius: var(--radius-md);
      text-align: center;
      font-weight: 600;
      font-size: 1.0625rem;
    }
    .calc-feedback.visible {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      animation: feedbackAppear 0.4s var(--spring);
    }
    @keyframes feedbackAppear {
      0% { opacity: 0; transform: translateY(10px) scale(0.95); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    .calc-feedback.correct {
      background: var(--kinmen-green-lighter);
      color: var(--kinmen-green);
      border: 2px solid var(--kinmen-green);
    }
    .calc-feedback.correct::before {
      content: '✓';
      width: 24px;
      height: 24px;
      background: var(--kinmen-green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
    }
    .calc-feedback.incorrect {
      background: var(--kinmen-red-lighter);
      color: var(--kinmen-red);
      border: 2px solid var(--kinmen-red);
    }
    .calc-feedback.incorrect::before {
      content: '✗';
      width: 24px;
      height: 24px;
      background: var(--kinmen-red);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
    }
    .next-calc-btn {
      display: none;
      margin: 24px auto 0;
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--kinmen-ocean) 0%, #4A7A8F 100%);
      color: white;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: var(--shadow-md);
    }
    .next-calc-btn.visible {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      animation: buttonAppear 0.4s var(--spring);
    }
    @keyframes buttonAppear {
      0% { opacity: 0; transform: translateY(10px) scale(0.9); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    .next-calc-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), var(--glow-ocean);
    }
    .next-calc-btn:active {
      transform: scale(0.98);
    }
    .next-calc-btn svg {
      width: 18px;
      height: 18px;
      transition: transform var(--duration-fast);
    }
    .next-calc-btn:hover svg {
      transform: translateX(3px);
    }

    /* 完成畫面 */
    .complete-screen {
      display: none;
      text-align: center;
      padding: 48px 32px;
      background: linear-gradient(180deg, transparent 0%, var(--kinmen-gold-light) 100%);
      border-radius: var(--radius-lg);
      margin-top: 24px;
    }
    .complete-screen.visible {
      display: block;
      animation: completeAppear 0.5s var(--spring);
    }
    @keyframes completeAppear {
      0% { opacity: 0; transform: scale(0.9) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    .complete-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 16px;
      background: linear-gradient(135deg, var(--kinmen-green) 0%, #5A8A4A 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg), var(--glow-green);
      animation: iconBounce 0.6s var(--spring) 0.2s both;
    }
    .complete-icon svg {
      width: 40px;
      height: 40px;
      color: white;
    }
    .complete-icon.trophy {
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    @keyframes iconBounce {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    .complete-title {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    .complete-message {
      font-size: 1.125rem;
      color: var(--text-secondary);
      margin-bottom: 32px;
    }
    .complete-message span {
      color: var(--kinmen-gold);
      font-weight: 700;
      font-size: 1.375rem;
    }
    .complete-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .complete-btn {
      padding: 14px 28px;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
      overflow: hidden;
    }
    .complete-btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
      opacity: 0;
      transition: opacity var(--duration-fast);
    }
    .complete-btn:hover::after { opacity: 1; }
    .complete-btn.primary {
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white;
      box-shadow: var(--shadow-md);
    }
    .complete-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .complete-btn.secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--kinmen-gold-light);
    }
    .complete-btn.secondary:hover {
      background: var(--kinmen-gold-light);
      border-color: var(--kinmen-gold);
      transform: translateY(-2px);
    }
    .complete-btn:active { transform: scale(0.98); }

    /* ========================================
       響應式 - Desktop Dashboard (>=1200px)
       ======================================== */
    @media (min-width: 1200px) {
      body {
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
      }

      .main-content {
        height: var(--content-height);
        max-width: 100%;
        padding: var(--dashboard-gap);
        display: grid;
        grid-template-areas:
          "modes main";
        grid-template-columns: 160px 1fr;
        gap: var(--dashboard-gap);
        overflow: hidden;
      }

      /* 練習模式變成左側垂直選擇 */
      .practice-modes {
        grid-area: modes;
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 0;
      }

      .practice-mode-card {
        padding: 16px 12px;
        text-align: center;
      }

      .mode-icon {
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
      }

      .mode-icon svg {
        width: 20px;
        height: 20px;
      }

      .mode-title {
        font-size: 0.9rem;
        margin-bottom: 4px;
      }

      .mode-desc {
        font-size: 0.7rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* 練習區域 */
      .practice-area {
        grid-area: main;
        padding: 20px;
        display: none;
        flex-direction: column;
        overflow: hidden;
      }

      .practice-area.active {
        display: flex;
      }

      /* 購物區域 Dashboard */
      #shopping-area .shopping-header {
        margin-bottom: 16px;
        flex-shrink: 0;
      }

      .shopping-title {
        font-size: 1.25rem;
        margin-bottom: 4px;
      }

      .shopping-desc {
        font-size: 0.875rem;
      }

      .shopping-list {
        margin-bottom: 16px;
        flex-shrink: 0;
        flex-wrap: wrap;
      }

      .shopping-item {
        padding: 8px 14px;
        font-size: 0.9rem;
      }

      .vocab-grid {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        overflow-y: auto;
        align-content: start;
        padding-right: 8px;
        scrollbar-width: thin;
      }

      .vocab-grid::-webkit-scrollbar {
        width: 4px;
      }

      .vocab-grid::-webkit-scrollbar-track {
        background: transparent;
      }

      .vocab-grid::-webkit-scrollbar-thumb {
        background: rgba(139, 105, 20, 0.2);
        border-radius: 2px;
      }

      .vocab-item {
        padding: 12px 8px;
      }

      .vocab-item img {
        width: 50px;
        height: 50px;
      }

      .vocab-item .vocab-name {
        font-size: 0.85rem;
        margin-top: 6px;
      }

      .shopping-progress {
        margin-top: 16px;
        flex-shrink: 0;
      }

      /* 計算區域 Dashboard */
      #calculation-area .calc-header {
        margin-bottom: 16px;
        flex-shrink: 0;
      }

      .calc-title {
        font-size: 1.25rem;
        margin-bottom: 4px;
      }

      .calc-desc {
        font-size: 0.875rem;
      }

      .calc-items {
        flex: 1;
        overflow-y: auto;
        padding-right: 8px;
        scrollbar-width: thin;
      }

      .calc-item {
        padding: 14px 16px;
        margin-bottom: 10px;
      }

      .calc-controls {
        margin-top: 16px;
        flex-shrink: 0;
      }

      /* 完成畫面 */
      .complete-screen {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 24px;
      }

      .complete-icon {
        width: 64px;
        height: 64px;
        margin-bottom: 12px;
      }

      .complete-icon svg {
        width: 32px;
        height: 32px;
      }

      .complete-title {
        font-size: 1.5rem;
      }

      .complete-message {
        font-size: 1rem;
        margin-bottom: 20px;
      }
    }

    /* Desktop Large (>=1400px) */
    @media (min-width: 1400px) {
      .main-content {
        grid-template-columns: 180px 1fr;
      }

      .practice-mode-card {
        padding: 20px 14px;
      }

      .mode-title {
        font-size: 1rem;
      }

      .mode-desc {
        font-size: 0.75rem;
      }

      .vocab-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
      }

      .vocab-item img {
        width: 60px;
        height: 60px;
      }
    }

    /* Tablet (768px - 1199px) */
    @media (min-width: 768px) and (max-width: 1199px) {
      .main-content {
        padding: 24px;
      }

      .practice-modes {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .practice-area {
        padding: 24px;
      }

      .vocab-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }

    /* Mobile (<768px) */
    @media (max-width: 767px) {
      .nav-header { padding: 12px 16px; }
      .page-title { font-size: 1rem; }
      .main-content { padding: 24px 16px 64px; }
      .practice-area { padding: 24px 16px; }
      .practice-modes { grid-template-columns: 1fr; }
      .vocab-grid { grid-template-columns: repeat(3, 1fr); }

      .practice-mode-card {
        min-height: var(--touch-target-comfortable);
      }

      .check-answer-btn, .next-calc-btn, .complete-btn {
        min-height: var(--touch-target-comfortable);
      }
    }
    @media (max-width: 480px) {
      .vocab-grid { grid-template-columns: repeat(2, 1fr); }
      .shopping-list { flex-direction: column; align-items: stretch; }

      .vocab-btn {
        min-width: 70px;
        min-height: 70px;
      }

      .answer-input {
        max-width: 120px;
        padding: 12px 16px;
        font-size: clamp(1rem, 4vw, 1.5rem);
      }

      .answer-unit {
        font-size: 1.25rem;
      }
    }

    /* 超小螢幕 (320px) */
    @media (max-width: 320px) {
      .main-content { padding: 16px 8px 56px; }
      .practice-area { padding: 16px 12px; }

      .shopping-title {
        font-size: 1.125rem;
      }

      .shopping-list {
        padding: 16px;
        gap: 8px;
      }

      .shopping-item {
        padding: 8px 12px;
        font-size: 0.875rem;
      }

      .vocab-grid {
        gap: 8px;
      }

      .vocab-btn {
        padding: 8px;
        min-width: 60px;
        min-height: 60px;
      }

      .vocab-btn .vocab-name {
        font-size: 0.6875rem;
      }

      .calculation-question {
        padding: 16px;
      }

      .question-item {
        padding: 10px 0;
      }

      .item-name {
        font-size: 0.9375rem;
      }

      .complete-screen {
        padding: 32px 16px;
      }

      .complete-title {
        font-size: 1.5rem;
      }

      .complete-actions {
        flex-direction: column;
        gap: 8px;
      }

      .complete-btn {
        width: 100%;
        padding: 12px 20px;
      }
    }

    /* 橫向模式 */
    @media (max-height: 500px) and (orientation: landscape) {
      .main-content { padding: 12px 16px 48px; }

      .practice-modes {
        display: flex;
        flex-direction: row;
        gap: 12px;
        margin-bottom: 16px;
      }

      .practice-mode-card {
        flex: 1;
        padding: 12px;
      }

      .mode-icon {
        width: 32px;
        height: 32px;
        margin-bottom: 8px;
      }

      .mode-title {
        font-size: 0.875rem;
      }

      .mode-desc {
        font-size: 0.6875rem;
      }

      .practice-area {
        padding: 16px;
      }

      .shopping-header, .calculation-header {
        margin-bottom: 16px;
      }

      .shopping-title, .calculation-title {
        font-size: 1.125rem;
        margin-bottom: 4px;
      }

      .shopping-list {
        padding: 12px;
        margin-bottom: 16px;
      }

      .vocab-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }

      .complete-screen {
        padding: 20px;
      }

      .complete-icon {
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
      }

      .complete-title {
        font-size: 1.25rem;
        margin-bottom: 4px;
      }

      .complete-message {
        font-size: 0.9375rem;
        margin-bottom: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="bg-pattern"></div>
  <div class="bg-gradient"></div>
  <div class="roof-deco"></div>

  <!-- 頂部導航 -->
  <header class="nav-header">
    <div class="nav-left">
      <a href="index.html" class="back-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"/>
          <polyline points="12 19 5 12 12 5"/>
        </svg>
        返回
      </a>
      <h1 class="page-title">實戰練習</h1>
    </div>
  </header>

  <main class="main-content">
    <!-- 練習模式選擇 -->
    <div class="practice-modes">
      <div class="practice-mode-card active" data-mode="shopping">
        <div class="mode-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
        </div>
        <h3 class="mode-title">購物清單挑戰</h3>
        <p class="mode-desc">根據清單找出正確的蔬果</p>
      </div>
      <div class="practice-mode-card" data-mode="calculation">
        <div class="mode-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </div>
        <h3 class="mode-title">計算總價</h3>
        <p class="mode-desc">聽價格計算總金額</p>
      </div>
    </div>

    <!-- 購物清單挑戰 -->
    <section id="shopping-area" class="practice-area active">
      <div class="shopping-header">
        <h2 class="shopping-title">購物清單挑戰</h2>
        <p class="shopping-desc">根據清單，從下方選出正確的蔬果</p>
      </div>

      <div class="shopping-list" id="shopping-list"></div>

      <div class="vocab-grid" id="vocab-grid"></div>

      <div class="shopping-progress" id="shopping-progress">
        <div class="progress-wrapper">
          <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%"></div>
          </div>
          <span class="progress-text" id="progress-text">0 / 5</span>
        </div>
      </div>

      <div class="complete-screen" id="shopping-complete">
        <div class="complete-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <h2 class="complete-title">購物完成！</h2>
        <p class="complete-message">你成功找到了所有的蔬果</p>
        <div class="complete-actions">
          <button class="complete-btn secondary" id="restart-shopping">再玩一次</button>
          <button class="complete-btn primary" id="try-calculation">挑戰計算價格</button>
        </div>
      </div>
    </section>

    <!-- 計算價格 -->
    <section id="calculation-area" class="practice-area">
      <div class="calculation-header">
        <h2 class="calculation-title">計算總價</h2>
        <p class="shopping-desc">計算購買的總金額</p>
      </div>

      <div id="calc-content">
        <div class="calculation-question" id="calc-question"></div>

        <div class="answer-section">
          <p class="answer-label">總共多少錢？</p>
          <div class="answer-input-group">
            <input type="number" class="answer-input" id="answer-input" placeholder="0">
            <span class="answer-unit">蚊</span>
          </div>
          <button class="check-answer-btn" id="check-answer-btn">確認答案</button>
        </div>

        <div class="calc-feedback" id="calc-feedback"></div>
        <button class="next-calc-btn" id="next-calc-btn">
          下一題
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </button>
      </div>

      <div class="complete-screen" id="calc-complete">
        <div class="complete-icon trophy">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
            <path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
          </svg>
        </div>
        <h2 class="complete-title">計算完成！</h2>
        <p class="complete-message">你答對了 <span id="calc-score">0</span> / <span id="calc-total">5</span> 題</p>
        <div class="complete-actions">
          <button class="complete-btn secondary" id="restart-calc">再試一次</button>
          <button class="complete-btn primary" id="back-home">回到首頁</button>
        </div>
      </div>
    </section>
  </main>

  <!-- 音頻播放器 -->
  <audio id="audio-player" playsinline preload="auto"></audio>

  <script type="module">
    import { getLocalProgress, savePracticeProgress, initProgress } from './js/api.js';

    let vocabulary = [];
    let shoppingList = [];
    let foundItems = new Set();
    const SHOPPING_ITEMS = 5;

    let calcQuestions = [];
    let currentCalcIndex = 0;
    let calcScore = 0;
    const CALC_TOTAL = 5;

    let practiceProgress = {};

    // DOM 元素
    const modeCards = document.querySelectorAll('.practice-mode-card');
    const practiceAreas = document.querySelectorAll('.practice-area');

    // 初始化
    async function init() {
      try {
        const response = await fetch('data/vocabulary.json');
        const data = await response.json();
        vocabulary = data.vocabulary;

        // 載入進度（本地或伺服器）
        const progress = await initProgress();
        if (progress.practice) {
          practiceProgress = progress.practice;
        }

        setupModeSwitch();
        initShopping();
        initCalculation();
      } catch (error) {
        console.error('載入失敗:', error);
      }
    }

    // 模式切換
    function setupModeSwitch() {
      modeCards.forEach(card => {
        card.addEventListener('click', () => {
          const mode = card.dataset.mode;
          modeCards.forEach(c => c.classList.toggle('active', c === card));
          practiceAreas.forEach(area => {
            area.classList.toggle('active', area.id === `${mode}-area`);
          });
        });
      });
    }

    // ========================================
    // 購物清單挑戰
    // ========================================
    function initShopping() {
      document.getElementById('restart-shopping').addEventListener('click', startShopping);
      document.getElementById('try-calculation').addEventListener('click', () => {
        document.querySelector('[data-mode="calculation"]').click();
      });

      startShopping();
    }

    function startShopping() {
      // 隨機選擇購物清單
      const shuffled = [...vocabulary].sort(() => Math.random() - 0.5);
      shoppingList = shuffled.slice(0, SHOPPING_ITEMS);
      foundItems = new Set();

      // 隱藏完成畫面
      document.getElementById('shopping-complete').classList.remove('visible');

      // 渲染購物清單
      renderShoppingList();

      // 渲染詞彙選項
      renderVocabGrid();

      updateShoppingProgress();
    }

    function renderShoppingList() {
      const container = document.getElementById('shopping-list');
      container.innerHTML = '';

      shoppingList.forEach(item => {
        const el = document.createElement('div');
        el.className = 'shopping-item';
        el.id = `list-${item.id}`;
        el.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
          </svg>
          <span>${item.chinese}</span>
          <span style="color: var(--kinmen-ocean); font-size: 0.875rem;">${item.pinyin}</span>
        `;
        container.appendChild(el);
      });
    }

    function renderVocabGrid() {
      const container = document.getElementById('vocab-grid');
      container.innerHTML = '';

      // 包含清單項目 + 其他隨機項目
      const otherItems = vocabulary
        .filter(v => !shoppingList.find(s => s.id === v.id))
        .sort(() => Math.random() - 0.5)
        .slice(0, 12 - SHOPPING_ITEMS);

      const allItems = [...shoppingList, ...otherItems].sort(() => Math.random() - 0.5);

      allItems.forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'vocab-btn';
        btn.dataset.id = item.id;
        btn.innerHTML = `
          <img src="${item.image}" alt="${item.chinese}">
          <span class="vocab-name">${item.chinese}</span>
        `;

        btn.addEventListener('click', () => selectVocab(btn, item));
        container.appendChild(btn);
      });
    }

    function selectVocab(btn, item) {
      const isInList = shoppingList.find(s => s.id === item.id);

      if (isInList && !foundItems.has(item.id)) {
        // 正確
        foundItems.add(item.id);
        btn.classList.add('found');

        // 更新清單項目
        const listItem = document.getElementById(`list-${item.id}`);
        if (listItem) {
          listItem.classList.add('found');
          listItem.querySelector('svg').innerHTML = `
            <polyline points="20 6 9 17 4 12"/>
          `;
        }

        updateShoppingProgress();

        // 檢查是否完成
        if (foundItems.size === SHOPPING_ITEMS) {
          setTimeout(() => {
            document.getElementById('shopping-complete').classList.add('visible');
            saveProgress('shopping');
          }, 500);
        }
      } else if (!isInList) {
        // 錯誤
        btn.classList.add('wrong');
        setTimeout(() => btn.classList.remove('wrong'), 500);
      }
    }

    function updateShoppingProgress() {
      const percentage = (foundItems.size / SHOPPING_ITEMS) * 100;
      document.getElementById('progress-bar-fill').style.width = `${percentage}%`;
      document.getElementById('progress-text').textContent =
        `${foundItems.size} / ${SHOPPING_ITEMS}`;
    }

    // ========================================
    // 計算價格
    // ========================================
    function initCalculation() {
      document.getElementById('check-answer-btn').addEventListener('click', checkAnswer);
      document.getElementById('next-calc-btn').addEventListener('click', nextCalcQuestion);
      document.getElementById('restart-calc').addEventListener('click', startCalculation);
      document.getElementById('back-home').addEventListener('click', () => {
        window.location.href = 'index.html';
      });

      document.getElementById('answer-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkAnswer();
      });

      startCalculation();
    }

    function startCalculation() {
      calcQuestions = [];
      currentCalcIndex = 0;
      calcScore = 0;

      // 生成計算題
      for (let i = 0; i < CALC_TOTAL; i++) {
        const itemCount = Math.floor(Math.random() * 2) + 2; // 2-3 項
        const items = [...vocabulary]
          .sort(() => Math.random() - 0.5)
          .slice(0, itemCount)
          .map(item => ({
            ...item,
            quantity: Math.floor(Math.random() * 3) + 1, // 1-3 斤
            pricePerUnit: (Math.floor(Math.random() * 8) + 3) * 10 // 30-100
          }));

        const total = items.reduce((sum, item) => sum + item.quantity * item.pricePerUnit, 0);

        calcQuestions.push({ items, total });
      }

      document.getElementById('calc-content').style.display = 'block';
      document.getElementById('calc-complete').classList.remove('visible');

      loadCalcQuestion();
    }

    function loadCalcQuestion() {
      const question = calcQuestions[currentCalcIndex];
      const container = document.getElementById('calc-question');
      const feedback = document.getElementById('calc-feedback');
      const nextBtn = document.getElementById('next-calc-btn');
      const input = document.getElementById('answer-input');

      container.innerHTML = '';
      feedback.classList.remove('visible', 'correct', 'incorrect');
      nextBtn.classList.remove('visible');
      input.value = '';
      input.disabled = false;

      question.items.forEach(item => {
        const el = document.createElement('div');
        el.className = 'question-item';
        el.innerHTML = `
          <span class="item-name">${item.chinese} x ${item.quantity} 斤</span>
          <div class="item-price">
            <span class="price-text">${item.pricePerUnit} 蚊/斤</span>
          </div>
        `;
        container.appendChild(el);
      });
    }

    function checkAnswer() {
      const question = calcQuestions[currentCalcIndex];
      const input = document.getElementById('answer-input');
      const feedback = document.getElementById('calc-feedback');
      const nextBtn = document.getElementById('next-calc-btn');

      const answer = parseInt(input.value) || 0;
      input.disabled = true;

      if (answer === question.total) {
        feedback.textContent = '答對了！';
        feedback.classList.add('visible', 'correct');
        calcScore++;
      } else {
        feedback.textContent = `答案是 ${question.total} 蚊`;
        feedback.classList.add('visible', 'incorrect');
      }

      nextBtn.classList.add('visible');
    }

    function nextCalcQuestion() {
      currentCalcIndex++;

      if (currentCalcIndex >= CALC_TOTAL) {
        showCalcResult();
      } else {
        loadCalcQuestion();
      }
    }

    function showCalcResult() {
      document.getElementById('calc-content').style.display = 'none';
      document.getElementById('calc-score').textContent = calcScore;
      document.getElementById('calc-total').textContent = CALC_TOTAL;
      document.getElementById('calc-complete').classList.add('visible');

      saveProgress('calculation');
    }

    // 儲存進度（本地 + 伺服器）
    function saveProgress(type) {
      if (type === 'shopping') {
        practiceProgress.shopping = { completed: true };
      } else if (type === 'calculation') {
        practiceProgress.calculation = { score: calcScore, total: CALC_TOTAL };
      }

      savePracticeProgress(practiceProgress);
    }

    // 初始化
    init();
  </script>
</body>
</html>
