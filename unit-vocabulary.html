<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èªè­˜è”¬æœ - é‡‘è²ç‰èª</title>
  <meta name="description" content="å­¸ç¿’é‡‘é–€è©±è”¬æœè©å½™">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&family=Noto+Serif+TC:wght@500;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Dashboard è®Šæ•¸ */
      --header-height: 56px;
      --content-height: calc(100dvh - var(--header-height) - 8px);
      --dashboard-gap: 1rem;
      --sidebar-width: 160px;

      /* å‹•æ…‹å­—é«” */
      --h1-size: clamp(1.5rem, 3vw, 2.5rem);
      --h2-size: clamp(1.25rem, 2.5vw, 2rem);
      --body-size: clamp(0.875rem, 1.2vw, 1rem);

      /* å‹•æ…‹é–“è· */
      --section-gap: clamp(1rem, 2vw, 2rem);
      --card-padding: clamp(0.75rem, 1.5vw, 1.5rem);

      /* åŸæœ‰è®Šæ•¸ */
      --kinmen-gold: #D4A84B;
      --kinmen-gold-light: #F5E6C8;
      --kinmen-gold-dark: #8B6914;
      --kinmen-red: #C84B31;
      --kinmen-red-light: #E8B4A8;
      --kinmen-red-lighter: #FDF2F0;
      --kinmen-ocean: #5B8FA8;
      --kinmen-ocean-light: #C5DDE8;
      --kinmen-ocean-lighter: #E8F4F8;
      --kinmen-green: #7D9D6D;
      --kinmen-green-light: #D4E5CC;
      --kinmen-green-lighter: #EDF5E8;
      --bg-primary: #FDF6F0;
      --bg-secondary: #F5E8E0;
      --bg-card: #FFFFFF;
      --text-primary: #3D3229;
      --text-secondary: #6B5D52;
      --text-accent: #8B6914;
      --deco-brick: #B85A4A;
      --shadow-sm: 0 2px 8px rgba(61, 50, 41, 0.08);
      --shadow-md: 0 4px 16px rgba(61, 50, 41, 0.12);
      --shadow-lg: 0 8px 32px rgba(61, 50, 41, 0.16);
      --shadow-xl: 0 16px 48px rgba(61, 50, 41, 0.2);
      --shadow-2xl: 0 24px 64px rgba(61, 50, 41, 0.24);
      --shadow-lift-sm: 0 4px 12px rgba(61, 50, 41, 0.15);
      --shadow-lift-md: 0 8px 24px rgba(61, 50, 41, 0.18);
      --glow-gold: 0 0 20px rgba(212, 168, 75, 0.3);
      --glow-ocean: 0 0 20px rgba(91, 143, 168, 0.3);
      --glow-green: 0 0 20px rgba(125, 157, 109, 0.3);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-xl: 32px;
      --font-display: 'Noto Serif TC', serif;
      --font-body: 'Noto Sans TC', sans-serif;
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
      --duration-fast: 150ms;
      --duration-normal: 250ms;
      --duration-slow: 400ms;
      --duration-slower: 600ms;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; }
    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }
    button { font-family: inherit; border: none; background: none; cursor: pointer; }
    a { text-decoration: none; color: inherit; }
    img { max-width: 100%; height: auto; }

    /* å…¨åŸŸè§¸æ§å„ªåŒ– */
    button, [role="button"], .interactive, a, .mode-btn, .flashcard, .quiz-option, .match-card {
      touch-action: manipulation;
    }

    /* è¼¸å…¥æ¡†é˜² iOS ç¸®æ”¾ */
    input, textarea, select {
      font-size: max(16px, 1rem);
    }

    /* è§¸æ§ç›®æ¨™æ¨™æº– */
    :root {
      --touch-target-min: 44px;
      --touch-target-comfortable: 48px;
      --touch-spacing-min: 8px;
    }

    /* èƒŒæ™¯ */
    .bg-pattern {
      position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0.08;
      background-image:
        repeating-linear-gradient(45deg, var(--deco-brick) 0, var(--deco-brick) 2px, transparent 2px, transparent 20px),
        repeating-linear-gradient(-45deg, var(--deco-brick) 0, var(--deco-brick) 2px, transparent 2px, transparent 20px);
    }
    .bg-gradient {
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
      background:
        radial-gradient(ellipse 80% 50% at 20% 0%, rgba(212, 168, 75, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(91, 143, 168, 0.1) 0%, transparent 50%);
    }
    .roof-deco {
      position: fixed; top: 0; left: 0; right: 0; height: 8px;
      background: linear-gradient(90deg, var(--kinmen-gold) 0%, var(--kinmen-red) 25%, var(--kinmen-gold) 50%, var(--kinmen-red) 75%, var(--kinmen-gold) 100%);
      z-index: 100;
    }

    /* é ‚éƒ¨å°èˆª */
    .nav-header {
      position: sticky; top: 8px; z-index: 50;
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 24px;
      background: rgba(253, 246, 240, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(139, 105, 20, 0.1);
    }
    .nav-left { display: flex; align-items: center; gap: 16px; }
    .back-btn {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px; border-radius: var(--radius-md);
      color: var(--text-secondary); font-weight: 500;
      transition: all 0.25s var(--ease-out);
    }
    .back-btn:hover { background: var(--bg-secondary); color: var(--text-primary); }
    .back-btn svg { width: 20px; height: 20px; }
    .page-title {
      font-family: var(--font-display);
      font-size: 1.25rem; font-weight: 700;
      color: var(--text-accent);
    }
    .nav-right { display: flex; align-items: center; gap: 12px; }
    .progress-indicator {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px; background: var(--bg-secondary);
      border-radius: 100px; font-size: 0.875rem; color: var(--text-secondary);
    }

    /* ä¸»å…§å®¹ */
    .main-content {
      position: relative; z-index: 1;
      max-width: 1000px; margin: 0 auto;
      padding: 32px 24px 80px;
    }

    /* å­¸ç¿’æ¨¡å¼é¸æ“‡ */
    .mode-selector {
      display: flex; gap: 16px; margin-bottom: 32px;
      padding: 0;
      background: transparent;
      position: relative;
    }
    .mode-btn {
      flex: 1; padding: 20px 24px;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      border-radius: var(--radius-lg);
      color: var(--text-secondary); font-weight: 600;
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
      overflow: hidden;
      background: var(--bg-card);
      border: 2px solid transparent;
      box-shadow: var(--shadow-sm);
      min-height: var(--touch-target-comfortable);
    }
    .mode-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kinmen-gold), var(--kinmen-ocean));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform var(--duration-normal) var(--ease-out);
    }
    .mode-btn:hover {
      border-color: var(--kinmen-gold-light);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      color: var(--text-primary);
    }
    .mode-btn:hover::before {
      transform: scaleX(1);
    }
    .mode-btn.active {
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white;
      box-shadow: var(--shadow-lg), var(--glow-gold);
      border-color: transparent;
      transform: translateY(-2px);
    }
    .mode-btn.active::before {
      display: none;
    }
    .mode-btn .mode-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      transition: all var(--duration-normal) var(--ease-out);
    }
    .mode-btn:hover .mode-icon {
      background: var(--kinmen-gold-light);
      transform: scale(1.1);
    }
    .mode-btn.active .mode-icon {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    .mode-btn svg { width: 26px; height: 26px; transition: transform var(--duration-normal) var(--ease-out); }
    .mode-btn span { font-size: 0.9375rem; font-weight: 600; }

    /* å­¸ç¿’å€åŸŸ */
    .learning-area {
      display: none;
      animation: fadeIn 0.4s var(--ease-out);
    }
    .learning-area.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* ========================================
       é–ƒå¡å€åŸŸ
       ======================================== */
    .flashcard-container {
      display: flex; flex-direction: column; align-items: center;
    }
    .flashcard-wrapper {
      perspective: 1000px;
      width: 100%; max-width: 480px;
      margin-bottom: 32px;
    }
    .flashcard {
      position: relative;
      width: 100%; aspect-ratio: 4/3;
      cursor: pointer;
      transform-style: preserve-3d;
      transition: transform var(--duration-slower) var(--ease-out),
                  box-shadow var(--duration-slow) var(--ease-out);
    }
    .flashcard.flipped { transform: rotateY(180deg); }
    .flashcard.flipping {
      animation: flashcardFlip var(--duration-slower) var(--ease-out);
    }
    @keyframes flashcardFlip {
      0% { box-shadow: var(--shadow-lg); }
      50% { box-shadow: 0 20px 60px rgba(61, 50, 41, 0.35); }
      100% { box-shadow: var(--shadow-lg); }
    }
    .flashcard:hover:not(.flipped) {
      transform: translateY(-4px);
    }
    .flashcard-face {
      position: absolute; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      backface-visibility: hidden;
      padding: 32px;
      transition: box-shadow var(--duration-normal) var(--ease-out);
    }
    .flashcard-front {
      border: 3px solid var(--kinmen-gold-light);
    }
    .flashcard-front:hover {
      border-color: var(--kinmen-gold);
      box-shadow: var(--shadow-2xl), var(--glow-gold);
    }
    .flashcard-back {
      transform: rotateY(180deg);
      background: linear-gradient(135deg, var(--kinmen-gold-light) 0%, var(--bg-card) 30%, var(--kinmen-gold-light) 100%);
      border: 3px solid var(--kinmen-gold);
    }
    .card-image {
      width: 100%; height: 60%;
      object-fit: contain;
      border-radius: var(--radius-md);
      margin-bottom: 16px;
    }
    .card-pinyin {
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--kinmen-ocean);
      margin-bottom: 8px;
    }
    .card-chinese {
      font-family: var(--font-display);
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    .card-hint {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card-hint::before {
      content: 'ğŸ‘†';
      animation: hintBounce 1.5s ease-in-out infinite;
    }
    @keyframes hintBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    .audio-btn-large {
      display: flex; align-items: center; justify-content: center;
      gap: 8px; padding: 12px 24px;
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white; border-radius: var(--radius-md);
      font-weight: 600;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
      min-height: var(--touch-target-comfortable);
      min-width: var(--touch-target-comfortable);
    }
    .audio-btn-large::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
      opacity: 0;
      transition: opacity var(--duration-fast);
    }
    .audio-btn-large:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .audio-btn-large:hover::before {
      opacity: 1;
    }
    .audio-btn-large:active {
      transform: scale(0.98);
    }
    .audio-btn-large.playing {
      animation: audioPulse 1s ease-in-out infinite;
    }
    @keyframes audioPulse {
      0%, 100% { transform: scale(1); box-shadow: var(--shadow-md); }
      50% { transform: scale(1.03); box-shadow: var(--shadow-lg), 0 0 25px rgba(212, 168, 75, 0.4); }
    }
    .audio-btn-large svg { width: 24px; height: 24px; }

    /* é–ƒå¡å°èˆª */
    .flashcard-nav {
      display: flex; align-items: center; gap: 24px;
      margin-bottom: 24px;
    }
    .nav-btn-round {
      width: 56px; height: 56px;
      min-width: var(--touch-target-comfortable);
      min-height: var(--touch-target-comfortable);
      display: flex; align-items: center; justify-content: center;
      background: var(--bg-card);
      border-radius: 50%;
      box-shadow: var(--shadow-md);
      color: var(--text-secondary);
      transition: all 0.25s var(--ease-out);
    }
    .nav-btn-round:hover:not(:disabled) {
      background: var(--kinmen-gold);
      color: white;
      transform: scale(1.1);
      box-shadow: var(--shadow-lift-sm), var(--glow-gold);
    }
    .nav-btn-round:active:not(:disabled) {
      transform: scale(0.95);
      box-shadow: var(--shadow-sm);
    }
    .nav-btn-round:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      background: var(--bg-secondary);
      color: rgba(107, 93, 82, 0.5);
      box-shadow: none;
    }
    .nav-btn-round svg { width: 28px; height: 28px; }
    .card-counter {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    .card-counter span { color: var(--kinmen-gold); }

    /* é€²åº¦é» */
    .progress-dots {
      display: flex; flex-wrap: wrap;
      justify-content: center; gap: 8px;
      max-width: 400px;
    }
    .progress-dot {
      width: 12px; height: 12px;
      background: var(--bg-secondary);
      border-radius: 50%;
      transition: all var(--duration-normal) var(--ease-out);
      cursor: pointer;
      border: 2px solid transparent;
    }
    .progress-dot:hover {
      background: var(--kinmen-gold-light);
      transform: scale(1.2);
    }
    .progress-dot.viewed {
      background: var(--kinmen-ocean);
      border-color: var(--kinmen-ocean-light);
    }
    .progress-dot.current {
      background: var(--kinmen-gold);
      transform: scale(1.4);
      box-shadow: var(--glow-gold), 0 0 0 3px rgba(212, 168, 75, 0.2);
      animation: dotPulse 2s ease-in-out infinite;
    }
    @keyframes dotPulse {
      0%, 100% { box-shadow: var(--glow-gold), 0 0 0 3px rgba(212, 168, 75, 0.2); }
      50% { box-shadow: 0 0 25px rgba(212, 168, 75, 0.5), 0 0 0 5px rgba(212, 168, 75, 0.15); }
    }

    /* ========================================
       è½åŠ›æ¸¬é©—å€åŸŸ
       ======================================== */
    .quiz-container {
      max-width: 600px;
      margin: 0 auto;
    }
    .quiz-header {
      text-align: center;
      margin-bottom: 32px;
    }
    .quiz-question {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    .play-sound-btn {
      display: inline-flex;
      align-items: center; gap: 12px;
      padding: 20px 40px;
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white;
      border-radius: var(--radius-lg);
      font-size: 1.125rem;
      font-weight: 600;
      box-shadow: var(--shadow-lg), var(--glow-gold);
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
      overflow: hidden;
    }
    .play-sound-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%, transparent 100%);
      opacity: 0;
      transition: opacity var(--duration-normal);
    }
    .play-sound-btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: var(--shadow-xl), 0 0 30px rgba(212, 168, 75, 0.4);
    }
    .play-sound-btn:hover::before {
      opacity: 1;
    }
    .play-sound-btn:active {
      transform: scale(0.98);
      box-shadow: var(--shadow-md);
    }
    .play-sound-btn.playing {
      animation: soundPulse 1s ease-in-out infinite;
    }
    @keyframes soundPulse {
      0%, 100% { transform: scale(1); box-shadow: var(--shadow-lg), var(--glow-gold); }
      50% { transform: scale(1.03); box-shadow: var(--shadow-xl), 0 0 35px rgba(212, 168, 75, 0.5); }
    }
    .play-sound-btn svg { width: 32px; height: 32px; }
    .quiz-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 32px;
    }
    .quiz-option {
      position: relative;
      aspect-ratio: 1;
      background: var(--bg-card);
      border: 3px solid var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all var(--duration-normal) var(--ease-out);
      overflow: hidden;
    }
    .quiz-option:hover:not(.disabled) {
      border-color: var(--kinmen-gold);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .quiz-option:active:not(.disabled) {
      transform: scale(0.96);
      box-shadow: var(--shadow-sm);
    }
    .quiz-option.selected {
      border: 3px dashed var(--kinmen-ocean);
      background: var(--kinmen-ocean-lighter);
      box-shadow: var(--glow-ocean);
    }
    .quiz-option.correct {
      border-color: var(--kinmen-green);
      background: var(--kinmen-green-lighter);
      box-shadow: var(--glow-green);
      animation: correctPulse 0.6s var(--ease-out);
    }
    .quiz-option.correct::after {
      content: 'âœ“';
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      background: var(--kinmen-green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: bold;
      animation: iconPop 0.4s var(--spring);
    }
    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); box-shadow: 0 0 30px rgba(125, 157, 109, 0.5); }
      100% { transform: scale(1); box-shadow: var(--glow-green); }
    }
    @keyframes iconPop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); opacity: 1; }
    }
    .quiz-option.incorrect {
      border-color: var(--kinmen-red);
      background: var(--kinmen-red-lighter);
      animation: incorrectShake 0.5s var(--ease-out);
    }
    .quiz-option.incorrect::after {
      content: 'âœ—';
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      background: var(--kinmen-red);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: bold;
      animation: iconPop 0.4s var(--spring);
    }
    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      15% { transform: translateX(-8px); }
      30% { transform: translateX(8px); }
      45% { transform: translateX(-6px); }
      60% { transform: translateX(6px); }
      75% { transform: translateX(-3px); }
      90% { transform: translateX(3px); }
    }
    .quiz-option.disabled { pointer-events: none; }
    .quiz-option img {
      width: 70%; height: 70%;
      object-fit: contain;
    }
    .quiz-option .option-text {
      font-weight: 600;
      color: var(--text-primary);
      margin-top: 8px;
    }
    .quiz-feedback {
      display: none;
      text-align: center;
      margin-top: 24px;
      padding: 16px;
      border-radius: var(--radius-md);
      font-weight: 600;
    }
    .quiz-feedback.visible { display: block; animation: fadeIn 0.3s var(--ease-out); }
    .quiz-feedback.correct { background: var(--kinmen-green-light); color: var(--kinmen-green); }
    .quiz-feedback.incorrect { background: var(--kinmen-red-light); color: var(--kinmen-red); }
    .next-question-btn {
      display: none;
      margin: 24px auto 0;
      padding: 14px 32px;
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    .next-question-btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
      opacity: 0;
      transition: opacity var(--duration-fast);
    }
    .next-question-btn.visible {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      animation: buttonAppear 0.4s var(--spring);
    }
    @keyframes buttonAppear {
      0% { opacity: 0; transform: translateY(10px) scale(0.9); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    .next-question-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .next-question-btn:hover::after {
      opacity: 1;
    }
    .next-question-btn:active {
      transform: scale(0.98);
      box-shadow: var(--shadow-sm);
    }
    .next-question-btn svg { width: 20px; height: 20px; transition: transform var(--duration-fast); }
    .next-question-btn:hover svg { transform: translateX(3px); }

    /* æ¸¬é©—çµæœ */
    .quiz-result {
      display: none;
      text-align: center;
      padding: 48px 32px;
      background: linear-gradient(180deg, var(--bg-card) 0%, var(--kinmen-gold-light) 100%);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      position: relative;
      overflow: hidden;
    }
    .quiz-result::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kinmen-gold), var(--kinmen-ocean), var(--kinmen-green));
    }
    .quiz-result.visible {
      display: block;
      animation: resultAppear 0.5s var(--spring);
    }
    @keyframes resultAppear {
      0% { opacity: 0; transform: scale(0.9) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    .result-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 16px;
      background: linear-gradient(135deg, var(--kinmen-green) 0%, #5A8A4A 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg), var(--glow-green);
      animation: iconBounce 0.6s var(--spring) 0.2s both;
    }
    .result-icon svg {
      width: 40px;
      height: 40px;
      color: white;
    }
    .result-icon.trophy {
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .result-icon.good {
      background: linear-gradient(135deg, var(--kinmen-ocean) 0%, #3A6A8A 100%);
      box-shadow: var(--shadow-lg), var(--glow-ocean);
    }
    .result-icon.effort {
      background: linear-gradient(135deg, var(--kinmen-coral) 0%, #C06A4F 100%);
      box-shadow: var(--shadow-lg), var(--glow-coral);
    }
    @keyframes iconBounce {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    .result-title {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    .result-score {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }
    .result-score span { color: var(--kinmen-gold); font-weight: 700; font-size: 1.5rem; }
    .result-actions { display: flex; gap: 12px; justify-content: center; }
    .result-btn {
      padding: 14px 28px;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
      overflow: hidden;
    }
    .result-btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
      opacity: 0;
      transition: opacity var(--duration-fast);
    }
    .result-btn:hover::after { opacity: 1; }
    .result-btn.primary {
      background: linear-gradient(135deg, var(--kinmen-gold) 0%, var(--kinmen-gold-dark) 100%);
      color: white;
      box-shadow: var(--shadow-md);
    }
    .result-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .result-btn.secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--kinmen-gold-light);
    }
    .result-btn.secondary:hover {
      background: var(--kinmen-gold-light);
      border-color: var(--kinmen-gold);
      transform: translateY(-2px);
    }
    .result-btn:active { transform: scale(0.98); }

    /* ========================================
       é…å°éŠæˆ²å€åŸŸ
       ======================================== */
    .matching-container {
      max-width: 800px;
      margin: 0 auto;
    }
    .matching-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    .matching-title {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    .matching-stats {
      display: flex;
      gap: 16px;
    }
    .stat-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--bg-card);
      border: 2px solid var(--bg-secondary);
      border-radius: 100px;
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 500;
      transition: all var(--duration-normal) var(--ease-out);
    }
    .stat-badge:first-child {
      border-color: var(--kinmen-ocean-light);
    }
    .stat-badge:first-child svg {
      color: var(--kinmen-ocean);
    }
    .stat-badge:last-child {
      border-color: var(--kinmen-green-light);
    }
    .stat-badge:last-child svg {
      color: var(--kinmen-green);
    }
    .stat-badge svg { width: 18px; height: 18px; }
    .matching-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }
    .match-card {
      aspect-ratio: 1;
      background: var(--bg-card);
      border: 3px solid var(--bg-secondary);
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px;
      cursor: pointer;
      transition: all var(--duration-normal) var(--ease-out);
      position: relative;
    }
    .match-card:hover:not(.matched):not(.selected) {
      border-color: var(--kinmen-gold);
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-lg), var(--glow-gold);
    }
    .match-card:active:not(.matched) {
      transform: scale(0.96);
    }
    .match-card.selected {
      border-color: var(--kinmen-ocean);
      background: var(--kinmen-ocean-lighter);
      box-shadow: var(--glow-ocean);
      transform: scale(1.02);
    }
    .match-card.matched {
      border-color: var(--kinmen-green);
      background: var(--kinmen-green-lighter);
      pointer-events: none;
      animation: matchSuccess 0.5s var(--spring);
    }
    .match-card.matched::after {
      content: 'âœ“';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 22px;
      height: 22px;
      background: var(--kinmen-green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      animation: iconPop 0.4s var(--spring);
    }
    @keyframes matchSuccess {
      0% { transform: scale(1); }
      30% { transform: scale(1.08); box-shadow: 0 0 25px rgba(125, 157, 109, 0.5); }
      100% { transform: scale(1); box-shadow: var(--glow-green); }
    }
    .match-card.wrong {
      animation: matchWrong 0.5s ease-out;
      border-color: var(--kinmen-red);
      background: var(--kinmen-red-lighter);
    }
    @keyframes matchWrong {
      0%, 100% { transform: translateX(0); }
      15% { transform: translateX(-8px); }
      30% { transform: translateX(8px); }
      45% { transform: translateX(-6px); }
      60% { transform: translateX(6px); }
      75% { transform: translateX(-3px); }
      90% { transform: translateX(3px); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
    }
    .match-card .card-content {
      text-align: center;
    }
    .match-card .card-text {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    .match-card .card-pinyin {
      font-size: 1rem;
      font-weight: 600;
      color: var(--kinmen-ocean);
    }
    .matching-complete {
      display: none;
      text-align: center;
      padding: 48px;
      background: linear-gradient(180deg, var(--bg-card) 0%, var(--kinmen-ocean-light) 100%);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      margin-top: 32px;
      position: relative;
      overflow: hidden;
    }
    .matching-complete::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kinmen-ocean), var(--kinmen-gold), var(--kinmen-green));
    }
    .matching-complete.visible {
      display: block;
      animation: resultAppear 0.5s var(--spring);
    }

    /* ========================================
       éŸ¿æ‡‰å¼ - Desktop Dashboard (>=1200px)
       ======================================== */
    @media (min-width: 1200px) {
      body {
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
      }

      .main-content {
        height: var(--content-height);
        max-width: 100%;
        padding: var(--dashboard-gap);
        display: flex;
        flex-direction: column;
        gap: var(--dashboard-gap);
        overflow: hidden;
      }

      /* Mode selector åœ¨ä¸Šæ–¹æ°´å¹³æ’åˆ— */
      .mode-selector {
        flex-direction: row;
        padding: 0;
        margin-bottom: 0;
        flex-shrink: 0;
        gap: 16px;
      }

      .mode-btn {
        flex-direction: row;
        padding: 16px 28px;
        text-align: center;
        gap: 14px;
      }

      .mode-btn .mode-icon {
        width: 44px;
        height: 44px;
      }

      .mode-btn svg {
        width: 24px;
        height: 24px;
      }

      .mode-btn span {
        font-size: 1rem;
        font-weight: 600;
      }

      .mode-btn::before {
        bottom: 0;
        left: 50%;
        right: auto;
        top: auto;
        transform: translateX(-50%) scaleX(0);
        width: 60%;
        height: 3px;
      }

      .mode-btn:hover::before {
        transform: translateX(-50%) scaleX(0.6);
      }

      /* å­¸ç¿’å€åŸŸ */
      .learning-area {
        flex: 1;
        height: 100%;
        overflow: hidden;
        display: none;
      }

      .learning-area.active {
        display: flex;
        flex-direction: column;
      }

      /* é–ƒå¡å€åŸŸ Dashboard */
      .flashcard-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 16px;
      }

      .flashcard-wrapper {
        max-width: min(700px, 75vh);
        margin-bottom: 16px;
      }

      .flashcard {
        aspect-ratio: 4/3;
      }

      .flashcard-face {
        padding: 40px;
      }

      .card-image {
        height: 60%;
        margin-bottom: 20px;
      }

      .card-pinyin {
        font-size: 2.25rem;
        margin-bottom: 10px;
      }

      .card-chinese {
        font-size: 3.5rem;
        margin-bottom: 20px;
      }

      .audio-btn-large {
        padding: 14px 28px;
        font-size: 1.1rem;
      }

      .audio-btn-large svg {
        width: 24px;
        height: 24px;
      }

      .flashcard-nav {
        margin-bottom: 16px;
        gap: 28px;
      }

      .nav-btn-round {
        width: 60px;
        height: 60px;
      }

      .nav-btn-round svg {
        width: 30px;
        height: 30px;
      }

      .card-counter {
        font-size: 1.35rem;
      }

      .progress-dots {
        max-width: 450px;
        gap: 8px;
      }

      .progress-dot {
        width: 12px;
        height: 12px;
      }

      /* è½åŠ›æ¸¬é©— Dashboard */
      .quiz-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        max-width: 800px;
        margin: 0 auto;
      }

      #quiz-content {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .quiz-header {
        margin-bottom: 28px;
      }

      .quiz-question {
        font-size: 1.75rem;
        margin-bottom: 16px;
      }

      .play-sound-btn {
        padding: 20px 40px;
        font-size: 1.25rem;
      }

      .play-sound-btn svg {
        width: 32px;
        height: 32px;
      }

      .quiz-options {
        max-width: 700px;
        width: 100%;
        margin-top: 32px;
        gap: 20px;
      }

      .quiz-option {
        aspect-ratio: 1;
        padding: 20px;
      }

      .quiz-option img {
        width: 70%;
        height: 70%;
      }

      .quiz-option .option-text {
        font-size: 1.25rem;
        margin-top: 12px;
      }

      .quiz-feedback {
        margin-top: 24px;
        padding: 16px 24px;
        font-size: 1.1rem;
      }

      .next-question-btn {
        margin-top: 24px;
        padding: 14px 32px;
        font-size: 1.1rem;
      }

      .quiz-result {
        padding: 48px 32px;
      }

      .result-icon {
        width: 80px;
        height: 80px;
      }

      .result-icon svg {
        width: 40px;
        height: 40px;
      }

      .result-title {
        font-size: 2rem;
      }

      .result-score {
        font-size: 1.25rem;
        margin-bottom: 24px;
      }

      /* é…å°éŠæˆ² Dashboard */
      .matching-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        max-width: 900px;
        margin: 0 auto;
      }

      .matching-header {
        margin-bottom: 24px;
        flex-shrink: 0;
      }

      .matching-title {
        font-size: 1.5rem;
      }

      .matching-stats .stat-badge {
        padding: 10px 20px;
        font-size: 1rem;
      }

      .matching-grid {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        align-content: center;
        max-height: calc(100% - 100px);
      }

      .match-card {
        aspect-ratio: 1;
        padding: 16px;
      }

      .match-card .card-text {
        font-size: 1.75rem;
      }

      .match-card .card-pinyin {
        font-size: 1.1rem;
      }

      .matching-complete {
        padding: 48px;
        margin-top: 24px;
      }

      .matching-complete .result-title {
        font-size: 2rem;
      }

      .matching-complete .result-score {
        font-size: 1.25rem;
      }
    }

    /* Desktop Large (>=1400px) */
    @media (min-width: 1400px) {
      .flashcard-wrapper {
        max-width: min(800px, 80vh);
      }

      .flashcard-face {
        padding: 48px;
      }

      .card-image {
        height: 62%;
      }

      .card-pinyin {
        font-size: 2.5rem;
      }

      .card-chinese {
        font-size: 4rem;
      }

      .mode-btn {
        padding: 18px 32px;
      }

      .mode-btn .mode-icon {
        width: 48px;
        height: 48px;
      }

      .mode-btn svg {
        width: 26px;
        height: 26px;
      }

      /* è½åŠ›æ¸¬é©— */
      .quiz-container {
        max-width: 900px;
      }

      .quiz-question {
        font-size: 2rem;
      }

      .play-sound-btn {
        padding: 24px 48px;
        font-size: 1.35rem;
      }

      .quiz-options {
        max-width: 800px;
        gap: 24px;
      }

      .quiz-option {
        padding: 24px;
      }

      .quiz-option img {
        width: 72%;
        height: 72%;
      }

      .quiz-option .option-text {
        font-size: 1.5rem;
      }

      /* é…å°éŠæˆ² */
      .matching-container {
        max-width: 1000px;
      }

      .matching-title {
        font-size: 1.75rem;
      }

      .matching-grid {
        gap: 24px;
      }

      .match-card {
        padding: 20px;
      }

      .match-card .card-text {
        font-size: 2rem;
      }

      .match-card .card-pinyin {
        font-size: 1.25rem;
      }
    }

    /* Tablet (768px - 1199px) */
    @media (min-width: 768px) and (max-width: 1199px) {
      .main-content {
        padding: 24px;
      }

      .mode-selector {
        flex-direction: row;
      }

      .mode-btn {
        flex-direction: column;
        padding: 14px 16px;
      }

      .flashcard-wrapper {
        max-width: 420px;
      }

      .matching-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
      }
    }

    /* Mobile (<768px) */
    @media (max-width: 767px) {
      .nav-header { padding: 12px 16px; }
      .page-title { font-size: 1rem; }
      .mode-selector { flex-direction: column; }
      .mode-btn {
        flex-direction: row;
        padding: 12px 16px;
        min-height: var(--touch-target-comfortable);
      }
      .quiz-options { grid-template-columns: repeat(2, 1fr); gap: 12px; }
      .matching-grid { grid-template-columns: repeat(3, 1fr); gap: 12px; }
      .flashcard-wrapper { max-width: 100%; }
      .card-chinese { font-size: 2rem; }
      .card-pinyin { font-size: 1.25rem; }

      .play-sound-btn {
        min-height: var(--touch-target-comfortable);
        padding: 16px 32px;
      }

      .next-question-btn, .result-btn {
        min-height: var(--touch-target-comfortable);
      }
    }
    @media (max-width: 480px) {
      .matching-grid { grid-template-columns: repeat(2, 1fr); }
      .match-card .card-text { font-size: 1.25rem; }
      .flashcard-nav { gap: 16px; }
      .nav-btn-round {
        width: var(--touch-target-comfortable);
        height: var(--touch-target-comfortable);
        min-width: var(--touch-target-min);
        min-height: var(--touch-target-min);
      }

      .quiz-option {
        min-height: 100px;
      }

      .match-card {
        min-height: 80px;
      }
    }

    /* è¶…å°è¢å¹• (320px) */
    @media (max-width: 320px) {
      .main-content {
        padding: 16px 8px 64px;
      }

      .mode-selector {
        gap: 8px;
        margin-bottom: 16px;
      }

      .mode-btn {
        padding: 10px 12px;
      }

      .mode-btn .mode-icon {
        width: 36px;
        height: 36px;
      }

      .mode-btn svg {
        width: 20px;
        height: 20px;
      }

      .mode-btn span {
        font-size: 0.8125rem;
      }

      /* é–ƒå¡ */
      .flashcard-face {
        padding: 20px;
      }

      .card-chinese {
        font-size: 1.75rem;
      }

      .card-pinyin {
        font-size: 1rem;
      }

      .card-hint {
        font-size: 0.8125rem;
      }

      .audio-btn-large {
        padding: 10px 20px;
        font-size: 0.875rem;
      }

      .flashcard-nav {
        gap: 12px;
        margin-bottom: 16px;
      }

      .nav-btn-round {
        width: var(--touch-target-min);
        height: var(--touch-target-min);
      }

      .nav-btn-round svg {
        width: 22px;
        height: 22px;
      }

      .card-counter {
        font-size: 1rem;
      }

      .progress-dots {
        gap: 6px;
      }

      .progress-dot {
        width: 10px;
        height: 10px;
      }

      /* è½åŠ›æ¸¬é©— */
      .quiz-question {
        font-size: 1.125rem;
        margin-bottom: 12px;
      }

      .play-sound-btn {
        padding: 14px 28px;
        font-size: 0.9375rem;
      }

      .play-sound-btn svg {
        width: 24px;
        height: 24px;
      }

      .quiz-options {
        gap: 8px;
        margin-top: 20px;
      }

      .quiz-option {
        padding: 12px;
        min-height: 80px;
      }

      .quiz-option .option-text {
        font-size: 0.8125rem;
      }

      .quiz-feedback {
        padding: 12px;
        font-size: 0.875rem;
      }

      .next-question-btn {
        padding: 12px 24px;
        font-size: 0.9375rem;
      }

      /* æ¸¬é©—çµæœ */
      .quiz-result {
        padding: 32px 20px;
      }

      .result-icon {
        width: 60px;
        height: 60px;
      }

      .result-icon svg {
        width: 30px;
        height: 30px;
      }

      .result-title {
        font-size: 1.5rem;
      }

      .result-score {
        font-size: 1rem;
      }

      .result-actions {
        flex-direction: column;
        gap: 8px;
      }

      .result-btn {
        width: 100%;
        padding: 12px 20px;
      }

      /* é…å°éŠæˆ² */
      .matching-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
        margin-bottom: 16px;
      }

      .matching-title {
        font-size: 1rem;
      }

      .matching-stats {
        gap: 8px;
      }

      .stat-badge {
        padding: 6px 12px;
        font-size: 0.75rem;
      }

      .matching-grid {
        gap: 8px;
      }

      .match-card {
        padding: 10px;
        min-height: 70px;
      }

      .match-card .card-text {
        font-size: 1rem;
      }

      .match-card .card-pinyin {
        font-size: 0.75rem;
      }

      .matching-complete {
        padding: 32px 16px;
      }
    }

    /* æ©«å‘æ¨¡å¼ */
    @media (max-height: 500px) and (orientation: landscape) {
      .main-content {
        padding: 12px 16px 48px;
      }

      .mode-selector {
        flex-direction: row;
        margin-bottom: 12px;
      }

      .mode-btn {
        padding: 10px 16px;
        flex-direction: row;
      }

      .mode-btn .mode-icon {
        width: 32px;
        height: 32px;
      }

      /* é–ƒå¡ */
      .flashcard-container {
        gap: 8px;
      }

      .flashcard-wrapper {
        max-width: 50vh;
        margin-bottom: 8px;
      }

      .flashcard-face {
        padding: 16px;
      }

      .card-image {
        height: 50%;
        margin-bottom: 8px;
      }

      .card-pinyin {
        font-size: 1.25rem;
        margin-bottom: 4px;
      }

      .card-chinese {
        font-size: 1.75rem;
        margin-bottom: 8px;
      }

      .audio-btn-large {
        padding: 8px 16px;
        font-size: 0.875rem;
      }

      .flashcard-nav {
        gap: 16px;
        margin-bottom: 8px;
      }

      .nav-btn-round {
        width: 40px;
        height: 40px;
      }

      .card-counter {
        font-size: 1rem;
      }

      .progress-dots {
        gap: 4px;
      }

      .progress-dot {
        width: 8px;
        height: 8px;
      }

      /* è½åŠ›æ¸¬é©— */
      .quiz-header {
        margin-bottom: 16px;
      }

      .quiz-question {
        font-size: 1.125rem;
        margin-bottom: 12px;
      }

      .play-sound-btn {
        padding: 12px 24px;
        font-size: 1rem;
      }

      .quiz-options {
        margin-top: 16px;
        gap: 10px;
      }

      .quiz-option {
        padding: 12px;
      }

      /* é…å°éŠæˆ² */
      .matching-header {
        margin-bottom: 12px;
      }

      .matching-title {
        font-size: 1.125rem;
      }

      .matching-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }

      .match-card {
        padding: 10px;
      }

      .match-card .card-text {
        font-size: 1.125rem;
      }
    }
  </style>
</head>
<body>
  <div class="bg-pattern"></div>
  <div class="bg-gradient"></div>
  <div class="roof-deco"></div>

  <!-- é ‚éƒ¨å°èˆª -->
  <header class="nav-header">
    <div class="nav-left">
      <a href="index.html" class="back-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"/>
          <polyline points="12 19 5 12 12 5"/>
        </svg>
        è¿”å›
      </a>
      <h1 class="page-title">èªè­˜è”¬æœ</h1>
    </div>
    <div class="nav-right">
      <div class="progress-indicator">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
          <path d="M12 20h9"/>
          <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
        </svg>
        <span id="overall-progress">0 / 26</span>
      </div>
    </div>
  </header>

  <main class="main-content">
    <!-- å­¸ç¿’æ¨¡å¼é¸æ“‡ -->
    <div class="mode-selector">
      <button class="mode-btn active" data-mode="flashcard">
        <div class="mode-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
            <line x1="8" y1="21" x2="16" y2="21"/>
            <line x1="12" y1="17" x2="12" y2="21"/>
          </svg>
        </div>
        <span>è©å½™é–ƒå¡</span>
      </button>
      <button class="mode-btn" data-mode="listening">
        <div class="mode-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
          </svg>
        </div>
        <span>è½åŠ›æ¸¬é©—</span>
      </button>
      <button class="mode-btn" data-mode="matching">
        <div class="mode-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="9" x2="20" y2="9"/>
            <line x1="4" y1="15" x2="20" y2="15"/>
            <line x1="10" y1="3" x2="8" y2="21"/>
            <line x1="16" y1="3" x2="14" y2="21"/>
          </svg>
        </div>
        <span>é…å°éŠæˆ²</span>
      </button>
    </div>

    <!-- é–ƒå¡å€åŸŸ -->
    <section id="flashcard-area" class="learning-area active">
      <div class="flashcard-container">
        <div class="flashcard-wrapper">
          <div class="flashcard" id="flashcard">
            <div class="flashcard-face flashcard-front">
              <img src="" alt="" class="card-image" id="card-image">
              <p class="card-hint">é»æ“Šç¿»ç‰ŒæŸ¥çœ‹ç­”æ¡ˆ</p>
            </div>
            <div class="flashcard-face flashcard-back">
              <p class="card-pinyin" id="card-pinyin"></p>
              <p class="card-chinese" id="card-chinese"></p>
              <button class="audio-btn-large" id="card-audio-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                  <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                </svg>
                æ’­æ”¾ç™¼éŸ³
              </button>
            </div>
          </div>
        </div>

        <div class="flashcard-nav">
          <button class="nav-btn-round" id="prev-card">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
          </button>
          <div class="card-counter">
            <span id="current-card">1</span> / <span id="total-cards">26</span>
          </div>
          <button class="nav-btn-round" id="next-card">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
        </div>

        <div class="progress-dots" id="progress-dots"></div>
      </div>
    </section>

    <!-- è½åŠ›æ¸¬é©—å€åŸŸ -->
    <section id="listening-area" class="learning-area">
      <div class="quiz-container">
        <div id="quiz-content">
          <div class="quiz-header">
            <h2 class="quiz-question">è½ç™¼éŸ³ï¼Œé¸å‡ºæ­£ç¢ºçš„åœ–ç‰‡</h2>
            <button class="play-sound-btn" id="play-quiz-sound">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
              </svg>
              æ’­æ”¾ç™¼éŸ³
            </button>
          </div>
          <div class="quiz-options" id="quiz-options"></div>
          <div class="quiz-feedback" id="quiz-feedback"></div>
          <button class="next-question-btn" id="next-question">
            ä¸‹ä¸€é¡Œ
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
        </div>
        <div class="quiz-result" id="quiz-result">
          <div class="result-icon" id="result-icon"></div>
          <h2 class="result-title" id="result-title"></h2>
          <p class="result-score">ä½ ç­”å°äº† <span id="result-score">0</span> / <span id="result-total">10</span> é¡Œ</p>
          <div class="result-actions">
            <button class="result-btn secondary" id="retry-quiz">å†è©¦ä¸€æ¬¡</button>
            <button class="result-btn primary" id="continue-learning">ç¹¼çºŒå­¸ç¿’</button>
          </div>
        </div>
      </div>
    </section>

    <!-- é…å°éŠæˆ²å€åŸŸ -->
    <section id="matching-area" class="learning-area">
      <div class="matching-container">
        <div class="matching-header">
          <h2 class="matching-title">å°‡æ¼¢å­—èˆ‡æ‹¼éŸ³é…å°</h2>
          <div class="matching-stats">
            <div class="stat-badge">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span id="match-time">00:00</span>
            </div>
            <div class="stat-badge">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 11 12 14 22 4"/>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
              </svg>
              <span id="match-pairs">0 / 8</span>
            </div>
          </div>
        </div>
        <div class="matching-grid" id="matching-grid"></div>
        <div class="matching-complete" id="matching-complete">
          <div class="result-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
          </div>
          <h2 class="result-title">é…å°å®Œæˆï¼</h2>
          <p class="result-score">ç”¨æ™‚ <span id="match-final-time">00:00</span></p>
          <div class="result-actions">
            <button class="result-btn primary" id="restart-matching">å†ç©ä¸€æ¬¡</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- éŸ³é »æ’­æ”¾å™¨ -->
  <audio id="audio-player" playsinline preload="auto"></audio>

  <script type="module">
    import { getLocalProgress, saveVocabularyProgress, initProgress } from './js/api.js';

    // è¼‰å…¥è©å½™è³‡æ–™
    let vocabulary = [];
    let currentCardIndex = 0;
    let viewedCards = new Set();

    // è½åŠ›æ¸¬é©—ç‹€æ…‹
    let quizQuestions = [];
    let currentQuestionIndex = 0;
    let quizScore = 0;
    const QUIZ_TOTAL = 10;

    // é…å°éŠæˆ²ç‹€æ…‹
    let matchingCards = [];
    let selectedCard = null;
    let matchedPairs = 0;
    let matchTimer = null;
    let matchSeconds = 0;
    const MATCH_PAIRS = 8;

    // DOM å…ƒç´ 
    const modeBtns = document.querySelectorAll('.mode-btn');
    const learningAreas = document.querySelectorAll('.learning-area');

    // åˆå§‹åŒ–
    async function init() {
      try {
        const response = await fetch('data/vocabulary.json');
        const data = await response.json();
        vocabulary = data.vocabulary;

        // è¼‰å…¥é€²åº¦ï¼ˆæœ¬åœ°æˆ–ä¼ºæœå™¨ï¼‰
        const progress = await initProgress();
        if (progress.vocabulary?.viewedCards) {
          viewedCards = new Set(progress.vocabulary.viewedCards);
        }

        updateOverallProgress();
        initFlashcards();
        initListening();
        initMatching();
      } catch (error) {
        console.error('è¼‰å…¥è©å½™å¤±æ•—:', error);
      }
    }

    // æ¨¡å¼åˆ‡æ›
    modeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const mode = btn.dataset.mode;
        modeBtns.forEach(b => b.classList.toggle('active', b === btn));
        learningAreas.forEach(area => {
          area.classList.toggle('active', area.id === `${mode}-area`);
        });

        // é–‹å§‹é…å°è¨ˆæ™‚
        if (mode === 'matching' && !matchTimer) {
          startMatchTimer();
        } else if (mode !== 'matching') {
          stopMatchTimer();
        }
      });
    });

    // æ›´æ–°æ•´é«”é€²åº¦
    function updateOverallProgress() {
      document.getElementById('overall-progress').textContent = `${viewedCards.size} / ${vocabulary.length}`;
      saveProgress();
    }

    // å„²å­˜é€²åº¦ï¼ˆæœ¬åœ° + ä¼ºæœå™¨ï¼‰
    function saveProgress() {
      const vocabularyData = {
        flashcards: { viewed: viewedCards.size, total: vocabulary.length },
        viewedCards: Array.from(viewedCards)
      };
      saveVocabularyProgress(vocabularyData);
    }

    // ========================================
    // é–ƒå¡åŠŸèƒ½
    // ========================================
    function initFlashcards() {
      const flashcard = document.getElementById('flashcard');
      const prevBtn = document.getElementById('prev-card');
      const nextBtn = document.getElementById('next-card');
      const audioBtn = document.getElementById('card-audio-btn');
      const dotsContainer = document.getElementById('progress-dots');

      // å»ºç«‹é€²åº¦é»
      vocabulary.forEach((_, i) => {
        const dot = document.createElement('div');
        dot.className = 'progress-dot';
        dot.addEventListener('click', () => goToCard(i));
        dotsContainer.appendChild(dot);
      });

      // è¼‰å…¥ç¬¬ä¸€å¼µå¡ç‰‡
      loadCard(0);

      // ç¿»ç‰Œ
      flashcard.addEventListener('click', (e) => {
        if (e.target.closest('.audio-btn-large')) return;
        flashcard.classList.toggle('flipped');
        if (flashcard.classList.contains('flipped')) {
          viewedCards.add(currentCardIndex);
          updateOverallProgress();
          updateProgressDots();
        }
      });

      // å°èˆª
      prevBtn.addEventListener('click', () => goToCard(currentCardIndex - 1));
      nextBtn.addEventListener('click', () => goToCard(currentCardIndex + 1));

      // æ’­æ”¾éŸ³æª”
      audioBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        playAudio(vocabulary[currentCardIndex].audioFile, audioBtn);
      });

      // éµç›¤å°èˆª
      document.addEventListener('keydown', (e) => {
        if (document.getElementById('flashcard-area').classList.contains('active')) {
          if (e.key === 'ArrowLeft') goToCard(currentCardIndex - 1);
          if (e.key === 'ArrowRight') goToCard(currentCardIndex + 1);
          if (e.key === ' ') {
            e.preventDefault();
            flashcard.classList.toggle('flipped');
          }
        }
      });
    }

    function loadCard(index) {
      if (index < 0 || index >= vocabulary.length) return;

      const vocab = vocabulary[index];
      const flashcard = document.getElementById('flashcard');

      // ç§»é™¤ç¿»è½‰ç‹€æ…‹
      flashcard.classList.remove('flipped');

      // æ›´æ–°å…§å®¹
      document.getElementById('card-image').src = vocab.image;
      document.getElementById('card-image').alt = vocab.chinese;
      document.getElementById('card-pinyin').textContent = vocab.pinyin;
      document.getElementById('card-chinese').textContent = vocab.chinese;

      // æ›´æ–°è¨ˆæ•¸å™¨
      document.getElementById('current-card').textContent = index + 1;
      document.getElementById('total-cards').textContent = vocabulary.length;

      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.getElementById('prev-card').disabled = index === 0;
      document.getElementById('next-card').disabled = index === vocabulary.length - 1;

      currentCardIndex = index;
      updateProgressDots();
    }

    function goToCard(index) {
      if (index >= 0 && index < vocabulary.length) {
        loadCard(index);
      }
    }

    function updateProgressDots() {
      const dots = document.querySelectorAll('.progress-dot');
      dots.forEach((dot, i) => {
        dot.classList.toggle('current', i === currentCardIndex);
        dot.classList.toggle('viewed', viewedCards.has(i) && i !== currentCardIndex);
      });
    }

    // ========================================
    // è½åŠ›æ¸¬é©—åŠŸèƒ½
    // ========================================
    function initListening() {
      const playBtn = document.getElementById('play-quiz-sound');
      const nextBtn = document.getElementById('next-question');
      const retryBtn = document.getElementById('retry-quiz');
      const continueBtn = document.getElementById('continue-learning');

      playBtn.addEventListener('click', () => {
        const question = quizQuestions[currentQuestionIndex];
        playAudio(question.correct.audioFile, playBtn);
      });

      nextBtn.addEventListener('click', nextQuestion);
      retryBtn.addEventListener('click', startQuiz);
      continueBtn.addEventListener('click', () => {
        document.querySelector('[data-mode="flashcard"]').click();
      });

      startQuiz();
    }

    function startQuiz() {
      // éš¨æ©Ÿé¸æ“‡é¡Œç›®
      const shuffled = [...vocabulary].sort(() => Math.random() - 0.5);
      quizQuestions = shuffled.slice(0, QUIZ_TOTAL).map(correct => {
        const others = vocabulary.filter(v => v.id !== correct.id)
          .sort(() => Math.random() - 0.5)
          .slice(0, 3);
        const options = [correct, ...others].sort(() => Math.random() - 0.5);
        return { correct, options };
      });

      currentQuestionIndex = 0;
      quizScore = 0;

      document.getElementById('quiz-content').style.display = 'block';
      document.getElementById('quiz-result').classList.remove('visible');

      loadQuestion();
    }

    function loadQuestion() {
      const question = quizQuestions[currentQuestionIndex];
      const optionsContainer = document.getElementById('quiz-options');
      const feedback = document.getElementById('quiz-feedback');
      const nextBtn = document.getElementById('next-question');

      optionsContainer.innerHTML = '';
      feedback.classList.remove('visible', 'correct', 'incorrect');
      nextBtn.classList.remove('visible');

      question.options.forEach((option, i) => {
        const btn = document.createElement('button');
        btn.className = 'quiz-option';
        btn.innerHTML = `
          <img src="${option.image}" alt="">
          <span class="option-text">${option.chinese}</span>
        `;
        btn.addEventListener('click', () => selectOption(btn, option, question.correct));
        optionsContainer.appendChild(btn);
      });
    }

    function selectOption(btn, selected, correct) {
      const options = document.querySelectorAll('.quiz-option');
      const feedback = document.getElementById('quiz-feedback');
      const nextBtn = document.getElementById('next-question');

      options.forEach(opt => opt.classList.add('disabled'));

      if (selected.id === correct.id) {
        btn.classList.add('correct');
        feedback.textContent = 'ç­”å°äº†ï¼';
        feedback.classList.add('visible', 'correct');
        quizScore++;
      } else {
        btn.classList.add('incorrect');
        // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
        options.forEach(opt => {
          if (opt.querySelector('.option-text').textContent === correct.chinese) {
            opt.classList.add('correct');
          }
        });
        feedback.textContent = `ç­”æ¡ˆæ˜¯ã€Œ${correct.chinese}ã€ï¼ˆ${correct.pinyin}ï¼‰`;
        feedback.classList.add('visible', 'incorrect');
      }

      nextBtn.classList.add('visible');
    }

    function nextQuestion() {
      currentQuestionIndex++;

      if (currentQuestionIndex >= QUIZ_TOTAL) {
        showQuizResult();
      } else {
        loadQuestion();
      }
    }

    function showQuizResult() {
      document.getElementById('quiz-content').style.display = 'none';
      const result = document.getElementById('quiz-result');
      result.classList.add('visible');

      const icon = document.getElementById('result-icon');
      const title = document.getElementById('result-title');
      document.getElementById('result-score').textContent = quizScore;
      document.getElementById('result-total').textContent = QUIZ_TOTAL;

      // è¨­å®šåœ–ç¤ºç‚º SVG
      const trophySvg = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`;
      const checkSvg = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`;
      const thumbsUpSvg = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>`;
      const flexSvg = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10"/><path d="M12 12 12 6"/><path d="M12 12 16 14"/></svg>`;

      if (quizScore === QUIZ_TOTAL) {
        icon.innerHTML = trophySvg;
        icon.className = 'result-icon trophy';
        title.textContent = 'å®Œç¾ï¼';
      } else if (quizScore >= QUIZ_TOTAL * 0.8) {
        icon.innerHTML = checkSvg;
        icon.className = 'result-icon';
        title.textContent = 'å¤ªæ£’äº†ï¼';
      } else if (quizScore >= QUIZ_TOTAL * 0.6) {
        icon.innerHTML = thumbsUpSvg;
        icon.className = 'result-icon good';
        title.textContent = 'ä¸éŒ¯å–”ï¼';
      } else {
        icon.innerHTML = flexSvg;
        icon.className = 'result-icon effort';
        title.textContent = 'ç¹¼çºŒåŠ æ²¹ï¼';
      }
    }

    // ========================================
    // é…å°éŠæˆ²åŠŸèƒ½
    // ========================================
    function initMatching() {
      document.getElementById('restart-matching').addEventListener('click', startMatching);
      startMatching();
    }

    function startMatching() {
      const grid = document.getElementById('matching-grid');
      const complete = document.getElementById('matching-complete');

      grid.innerHTML = '';
      complete.classList.remove('visible');
      matchedPairs = 0;
      selectedCard = null;
      matchSeconds = 0;
      updateMatchStats();

      // éš¨æ©Ÿé¸æ“‡é…å°
      const shuffled = [...vocabulary].sort(() => Math.random() - 0.5).slice(0, MATCH_PAIRS);

      // å»ºç«‹å¡ç‰‡é™£åˆ—ï¼ˆæ¼¢å­— + æ‹¼éŸ³ï¼‰
      matchingCards = [];
      shuffled.forEach(vocab => {
        matchingCards.push({ type: 'chinese', value: vocab.chinese, id: vocab.id });
        matchingCards.push({ type: 'pinyin', value: vocab.pinyin, id: vocab.id });
      });

      // æ‰“äº‚é †åº
      matchingCards.sort(() => Math.random() - 0.5);

      // æ¸²æŸ“å¡ç‰‡
      matchingCards.forEach((card, i) => {
        const el = document.createElement('button');
        el.className = 'match-card';
        el.dataset.index = i;
        el.innerHTML = `
          <div class="card-content">
            <span class="${card.type === 'chinese' ? 'card-text' : 'card-pinyin'}">${card.value}</span>
          </div>
        `;
        el.addEventListener('click', () => selectMatchCard(el, card));
        grid.appendChild(el);
      });

      startMatchTimer();
    }

    function selectMatchCard(el, card) {
      if (el.classList.contains('matched') || el.classList.contains('selected')) return;

      if (!selectedCard) {
        // ç¬¬ä¸€å¼µå¡ç‰‡
        el.classList.add('selected');
        selectedCard = { el, card };
      } else {
        // ç¬¬äºŒå¼µå¡ç‰‡
        if (selectedCard.card.id === card.id && selectedCard.card.type !== card.type) {
          // é…å°æˆåŠŸ
          el.classList.add('matched');
          selectedCard.el.classList.add('matched');
          selectedCard.el.classList.remove('selected');
          matchedPairs++;
          updateMatchStats();

          if (matchedPairs === MATCH_PAIRS) {
            stopMatchTimer();
            setTimeout(() => {
              document.getElementById('match-final-time').textContent = formatTime(matchSeconds);
              document.getElementById('matching-complete').classList.add('visible');
            }, 500);
          }
        } else {
          // é…å°å¤±æ•—
          el.classList.add('wrong');
          selectedCard.el.classList.add('wrong');

          setTimeout(() => {
            el.classList.remove('wrong');
            selectedCard.el.classList.remove('wrong', 'selected');
            selectedCard = null;
          }, 600);
          return;
        }
        selectedCard = null;
      }
    }

    function updateMatchStats() {
      document.getElementById('match-pairs').textContent = `${matchedPairs} / ${MATCH_PAIRS}`;
    }

    function startMatchTimer() {
      stopMatchTimer();
      matchTimer = setInterval(() => {
        matchSeconds++;
        document.getElementById('match-time').textContent = formatTime(matchSeconds);
      }, 1000);
    }

    function stopMatchTimer() {
      if (matchTimer) {
        clearInterval(matchTimer);
        matchTimer = null;
      }
    }

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    // ========================================
    // éŸ³æª”æ’­æ”¾
    // ========================================
    function playAudio(src, btn) {
      const audio = document.getElementById('audio-player');
      audio.src = src;
      btn?.classList.add('playing');

      audio.play().catch(err => {
        console.log('éŸ³æª”æ’­æ”¾å¤±æ•—:', err);
        btn?.classList.remove('playing');
      });

      audio.onended = () => btn?.classList.remove('playing');
    }

    // åˆå§‹åŒ–
    init();
  </script>
</body>
</html>
